<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GXO Instances Manager</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --gxo-blue: #003DA5;
            --gxo-orange: #FF3A00;
            --gxo-gray: #6D6E71;
            --gxo-light-gray: #E5E5E5;
            --gxo-white: #FFFFFF;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--gxo-light-gray);
            color: var(--gxo-gray);
        }

        .header {
            background: linear-gradient(135deg, var(--gxo-orange) 0%, var(--gxo-blue) 100%);
            color: var(--gxo-white);
            padding: 20px 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .container { max-width: 1400px; margin: 0 auto; padding: 30px 40px; }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--gxo-white);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            text-align: center;
        }

        .tab, .tab-link {
            padding: 12px 24px;
            background: transparent;
            border: none;
            color: #FF3A00;
            font-size: 16px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 500;
            text-decoration: none;
            display: inline-block;
        }

        .tab:hover, .tab-link:hover {
            color: var(--gxo-blue);
        }

        .tab.active {
            color: var(--gxo-blue);
            border-bottom-color: var(--gxo-blue);
        }

        .stat-value { font-size: 35px; font-weight: 700; display: block; }
        .stat-label { color: var(--gxo-gray); font-size: 15px; margin-top: 5px; text-transform: uppercase; }

        .results-color { color: var(--gxo-orange); }
        .live-color { color: #00ff15; }

        .search-box { display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;}
        .search-input { flex: 1; min-width: 250px; padding: 12px 20px; border: 2px solid #FF3A00; border-radius: 6px; font-size: 16px; color: #FF3A00;}
        .filter-select { padding: 12px 20px; border: 2px solid #FF3A00; color:#FF3A00; border-radius: 6px; background: white; min-width: 150px; }

        .tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #FF3A00; }

        .instances-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 20px; }
        .instance-card { background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); transition: transform 0.2s; }
        .instance-card:hover { transform: translateY(-4px); box-shadow: 0 4px 16px rgba(0,61,165,0.15); }

        .instance-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 2px solid var(--gxo-light-gray); }
        .instance-name { font-size: 20px; font-weight: 600; color: var(--gxo-orange); }

        .live-badge { padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; color: white; }
        .live-badge.yes { background: #21ff29; }
        .live-badge.no { background: #ff5252; }

        .info-row { display: flex; font-size: 14px; margin-bottom: 8px; }
        .info-label { font-weight: 600; color: var(--gxo-blue); min-width: 120px; }

        .products { margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--gxo-light-gray); }
        .product-tag { display: inline-block; background: var(--gxo-blue); color: white; padding: 4px 10px; border-radius: 4px; font-size: 11px; margin: 0 6px 6px 0; }

        .urls-section { margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--gxo-light-gray); }
        .url-group { margin-bottom: 10px; }
        .url-label { font-size: 12px; font-weight: 600; color: var(--gxo-blue); margin-bottom: 4px; }
        .url-links { display: flex; gap: 10px; }
        .url-link-np { flex: 1; padding: 6px; background: var(--gxo-light-gray); color: #17d427; text-decoration: none; border-radius: 4px; font-size: 15px; text-align: center; font-weight: 500; }
        .url-link-prd { flex: 1; padding: 6px; background: var(--gxo-light-gray); color: #ff5252; text-decoration: none; border-radius: 4px; font-size: 15px; text-align: center; font-weight: 500; }
        .url-link:hover { background: var(--gxo-blue); color: white; }
        .url-link.disabled { opacity: 0.4; pointer-events: none; }

        .extensions-btn { width: 100%; margin-top: 15px; padding: 12px; background: #FF3A00; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 15px;}
        .loading { text-align: center; padding: 60px; color: var(--gxo-blue); font-weight: bold; }

        .location-info {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--gxo-light-gray);
            font-size: 13px;
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>GXO Logistics - BY WMS Instance Manager</h1>
        <p>Management and Monitoring WMS/TMS/PDC instances</p>
    </div>

    <div class="container">
        <div id="loadingIndicator" class="loading">Loading data from GitHub...</div>
        <div id="mainContent" style="display: none;">
            
            <div class="stats-bar" id="statsBar"></div>

            <div class="search-box">
                <input type="text" class="search-input" id="searchInput" placeholder="Find by Client, Warehouse, product...">
                
                <select class="filter-select" id="filterLive">
                    <option value="all">All status</option>
                    <option value="true">Live</option>
                    <option value="false">No Live</option>
                </select>

                <select class="filter-select" id="filterCountry">
                    <option value="all">All Countries</option>
                </select>
            </div>

            <div class="tabs">
                <button class="tab active" data-tab="all">Gxo BY WMS Instances</button>
                <a href="extensions.html" class="tab-link">Extensions</a> <!-- separado de los tabs filtrables -->
            </div>

            <div class="instances-grid" id="instancesGrid"></div>
        </div>
    </div>

    <script>
        const CONFIG = {
            owner: 'xavierpvgxo',
            repo: 'instances-manager',
            branch: 'main',
            path: 'data/instances.json'
        };

        let instancesData = [];
        let activeTab = 'all';

        async function init() {
            try {
                const resp = await fetch(`https://raw.githubusercontent.com/${CONFIG.owner}/${CONFIG.repo}/${CONFIG.branch}/${CONFIG.path}`);
                const data = await resp.json();
                instancesData = data.instances || [];
                
                document.getElementById('loadingIndicator').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';

                fillFilters();
                render();
                setupEvents();
            } catch (err) {
                document.getElementById('loadingIndicator').innerHTML = "Error loading data.";
            }
        }

        function fillFilters() {
            const countries = new Set();
            instancesData.forEach(i => {
                if(i.location?.country) countries.add(i.location.country);
            });

            const countEl = document.getElementById('filterCountry');
            if (countEl) {
                [...countries].sort().forEach(c => {
                    countEl.innerHTML += `<option value="${c}">${c}</option>`;
                });
            }
        }

        function render() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const liveF = document.getElementById('filterLive').value;
            const countF = document.getElementById('filterCountry').value;

            const filtered = instancesData.filter(i => {
                const matchesSearch = (i.client + i.id + i.site + (i.account || '') + (i.location?.country || '')).toLowerCase().includes(search);
                
                let matchesTab = true;
                if (activeTab === 'logistics') matchesTab = i.account === 'GXO Logistics';
                if (activeTab === 'enterprise') matchesTab = i.account === 'GXO Enterprise';

                const matchesLive = liveF === 'all' || String(i.live) === liveF;
                const matchesCount = countF === 'all' || i.location?.country === countF;

                return matchesSearch && matchesTab && matchesLive && matchesCount;
            });

            document.getElementById('statsBar').innerHTML = `
                <div class="stat-card">
                    <span class="stat-value results-color">${filtered.length}</span>
                    <span class="stat-label">Results</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value live-color">${filtered.filter(x => x.live).length}</span>
                    <span class="stat-label">Live</span>
                </div>
            `;

            document.getElementById('instancesGrid').innerHTML = filtered.map(instance => `
                <div class="instance-card">
                    <div class="instance-header">
                        <div class="instance-name">${instance.client}</div>
                        <div class="live-badge ${instance.live ? 'yes' : 'no'}">${instance.live ? '‚óè LIVE' : '‚óã NO LIVE'}</div>
                    </div>
                    
                    <div class="instance-info">
                        <div class="info-row"><span class="info-label">Account:</span><span>${instance.account || 'N/A'}</span></div>
                        <div class="info-row"><span class="info-label">Country:</span><span>${instance.location?.country || 'N/A'}</span></div>
                        <div class="info-row"><span class="info-label">Contact:</span><span>${instance.contact?.name || 'N/A'}</span></div>
                        <div class="info-row"><span class="info-label">Instance ID:</span><span>${instance.id}</span></div>
                        <div class="info-row"><span class="info-label">Site:</span><span>${instance.site}</span></div>
                        <div class="info-row"><span class="info-label">WMS Version:</span><span>${instance.versions?.WMS}</span></div>
                    </div>

                    <div class="location-info">
                        üìç <strong>${instance.location?.country || ''}</strong><br>
                        (${instance.location?.address || 'N/A'})
                    </div>

                    <div class="products">
                        ${(instance.products || []).map(p => `<span class="product-tag">${p}</span>`).join('')}
                    </div>

                    <div class="urls-section">
                        <div class="url-group">
                            <div class="url-label">WEB</div>
                            <div class="url-links">
                                <a href="${instance.urls?.np?.web || '#'}" class="url-link-np ${!instance.urls?.np?.web ? 'disabled' : ''}" target="_blank">Link to NP</a>
                                <a href="${instance.urls?.prod?.web || '#'}" class="url-link-prd ${!instance.urls?.prod?.web ? 'disabled' : ''}" target="_blank">Link to PROD</a>
                            </div>
                        </div>
                        <div class="url-group">
                            <div class="url-label">APP</div>
                            <div class="url-links">
                                <a href="${instance.urls?.np?.app || '#'}" class="url-link-np ${!instance.urls?.np?.app ? 'disabled' : ''}" target="_blank">Link to NP</a>
                                <a href="${instance.urls?.prod?.app || '#'}" class="url-link-prd ${!instance.urls?.prod?.app ? 'disabled' : ''}" target="_blank">Link to PROD</a>
                            </div>
                        </div>
                        <div class="url-group">
                            <div class="url-label">CONSOLE</div>
                            <div class="url-links">
                                <a href="${instance.urls?.np?.config || '#'}" class="url-link-np ${!instance.urls?.np?.config ? 'disabled' : ''}" target="_blank">Link to NP</a>
                                <a href="${instance.urls?.prod?.config || '#'}" class="url-link-prd ${!instance.urls?.prod?.config ? 'disabled' : ''}" target="_blank">Link to PROD</a>
                            </div>
                        </div>
                    </div>

                    <button class="extensions-btn" onclick="window.open('${instance.metadata?.repository || '#'}', '_blank')">
                        üõ†Ô∏è Extensions Repository
                    </button>
                </div>
            `).join('');
        }

        function setupEvents() {
            // Eventos para Tabs de filtrado
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    activeTab = tab.dataset.tab;
                    render();
                });
            });

            // Eventos para Buscador y Selects
            document.getElementById('searchInput').addEventListener('input', render);
            document.getElementById('filterLive').addEventListener('change', render);
            document.getElementById('filterCountry').addEventListener('change', render);
        }

        init();
    </script>
</body>
</html>
